# Документация

## Этап 1. Реализация базового шахматного движка dany_chess (AlphaZero-style)

---

## 1. Отчёт по проделанной работе

### 1.1 Цель этапа

Целью первого этапа разработки являлось создание **базового шахматного движка**, реализующего ключевые принципы архитектуры AlphaZero, против которого **уже возможно играть**, и который может быть использован как фундамент для дальнейшего наращивания функциональности (MCTS, обучение, self-play).

В рамках данного этапа **не ставилась задача обучения нейросети** или достижения высокой силы игры. Основной акцент был сделан на:

* корректную архитектуру движка;
* строгую модульность;
* интеграцию в существующее веб-приложение;
* соответствие современным подходам к построению шахматных ИИ.

---

### 1.2 Основные выполненные задачи

В ходе работы были выполнены следующие задачи:

1. **Спроектирована архитектура шахматного движка `dany_chess`**, отделённая от веб-приложения (Flask).
2. **Реализована нейросеть AlphaZero-стиля** с двумя головами:

   * value head — оценка позиции;
   * policy head — вероятности ходов (зарезервирована для следующих этапов).
3. **Реализован механизм кодирования шахматной позиции** из формата FEN в числовой тензор.
4. **Разработан базовый алгоритм выбора хода**, использующий:

   * генерацию легальных ходов;
   * оценку позиции после каждого хода;
   * выбор хода с наилучшей оценкой.
5. **Произведена замена ранее использовавшейся модели `chessnet`** на новый движок `dany_chess`.
6. **Обеспечена полная совместимость с существующим Flask-приложением** без изменения клиентской части.

---

### 1.3 Причины выбранных решений

* Использование библиотеки `python-chess` позволило:

  * гарантировать корректность шахматных правил;
  * избежать ошибок, связанных с генерацией ходов.
* Применение PyTorch обеспечивает:

  * гибкость при дальнейшем обучении;
  * совместимость с GPU;
  * удобство расширения архитектуры.
* Архитектура AlphaZero выбрана как **современный стандарт** для шахматных ИИ, превосходящий классические эвристические движки при наличии обучения.

---

## 2. Подробное объяснение реализации

### 2.1 Общая архитектура системы

Система логически разделена на два уровня:

1. **Веб-уровень (Flask)**
   Отвечает только за:

   * получение позиции от пользователя;
   * передачу её движку;
   * отображение результата.

2. **Уровень шахматного движка (`dany_chess`)**
   Отвечает за:

   * анализ позиции;
   * выбор оптимального хода.

Такое разделение соответствует принципам **чистой архитектуры** и упрощает сопровождение проекта.

---

### 2.2 Структура движка dany_chess

```
dany_chess/
├── model.py     — нейросеть AlphaZero-style
├── encoder.py   — преобразование позиции в тензор
├── infer.py     — оценка позиции
└── engine.py    — логика выбора хода
```

---

### 2.3 Нейросеть AlphaZeroNet (`model.py`)

Нейросеть состоит из трёх логических частей:

1. **Общий сверточный блок**
   Извлекает пространственные признаки шахматной позиции:

   * взаимное расположение фигур;
   * локальные тактические структуры.

2. **Value head**
   Выдаёт одно число в диапазоне `[-1, 1]`, интерпретируемое как:

   * `+1` — выигрыш текущей стороны;
   * `-1` — проигрыш.

3. **Policy head**
   Предсказывает вероятности возможных ходов.
   На первом этапе не используется, но необходим для:

   * Monte Carlo Tree Search;
   * обучения через self-play.

Таким образом, архитектура полностью соответствует концепции AlphaZero.

---

### 2.4 Кодирование шахматной позиции (`encoder.py`)

Шахматная доска кодируется в виде тензора размера `12 × 8 × 8`:

* 6 каналов — фигуры белых;
* 6 каналов — фигуры чёрных;
* значение `1` означает наличие фигуры на клетке.

Такое представление:

* интуитивно понятно;
* эффективно для сверточных нейросетей;
* широко используется в научных публикациях.

---

### 2.5 Алгоритм выбора хода (`engine.py`)

Алгоритм работы движка на первом этапе:

1. Из позиции FEN создаётся объект `chess.Board`.
2. Генерируются **все легальные ходы**.
3. Для каждого хода:

   * ход применяется к доске;
   * позиция кодируется в тензор;
   * нейросеть оценивает позицию;
   * ход отменяется.
4. Выбирается ход с **наилучшей оценкой value**.

Данный подход:

* гарантирует корректность ходов;
* демонстрирует стратегическое мышление;
* является упрощённой версией AlphaZero без MCTS.

---

### 2.6 Интеграция с Flask

Flask-приложение взаимодействует с движком через одну функцию:

```python
best_move(fen: str) -> chess.Move
```

Это обеспечивает:

* минимальную связанность компонентов;
* простоту дальнейшего расширения;
* независимость интерфейса от реализации движка.

---

## 3. Актуальность работы и сравнение с аналогами

### 3.1 Актуальность

Современные шахматные ИИ практически полностью отказались от:

* ручных эвристик;
* статических функций оценки.

На смену им пришли:

* нейросети;
* самообучение;
* MCTS.

Изучение и реализация AlphaZero-подобных алгоритмов является **актуальной научно-практической задачей**, так как такие подходы применяются не только в шахматах, но и в:

* го;
* сёги;
* задачах оптимального управления;
* reinforcement learning.

---

### 3.2 Сравнение с аналогами

| Подход                           | Характеристика                                      |
| -------------------------------- | --------------------------------------------------- |
| **Stockfish**                    | Классический движок с ручными эвристиками и minimax |
| **ChessNet (предыдущая версия)** | Чистая нейросеть без понимания правил               |
| **AlphaZero / Leela**            | Нейросеть + MCTS + самообучение                     |
| **dany_chess (этап 1)**          | Нейросеть + правила шахмат (база для AlphaZero)     |

**Преимущество dany_chess** по сравнению с простыми нейросетями:

* гарантированная легальность ходов;
* архитектурная готовность к MCTS;
* масштабируемость.

---

### 3.3 Значимость первого этапа

Первый этап является **фундаментальным**, так как:

* задаёт правильную архитектуру;
* позволяет немедленно получить рабочий результат;
* исключает необходимость переписывать код при добавлении MCTS и обучения.

---

## 4. Выводы по этапу

В рамках первого этапа был успешно реализован:

* работоспособный шахматный движок;
* AlphaZero-стиль архитектуры;
* интеграция с веб-приложением.

Результат полностью соответствует поставленным целям и создаёт прочную основу для реализации **Monte Carlo Tree Search и обучения через self-play** на последующих этапах.
